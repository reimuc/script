ps: &ps { type: select, proxies: [ Static, HK, TW, JP, KR, US, SG, DIRECT ] }
pt: &pt
  type: url-test
  url: https://cp.cloudflare.com/generate_204
  include-all: true
  tolerance: 50
  interval: 900 #å®‰å“å¯ç”¨1800ï¼Œä¹Ÿå°±æ˜¯åŠå°æ—¶
  lazy: false
  health-check:
    enable: true
    interval: 900
    url: https://cp.cloudflare.com/generate_204
    method: HEAD
    timeout: 5
    expected-status: "204"
dy: &dy
  type: http
  udp: true
  interval: 86400
  proxy: DIRECT
  lazy: true
  health-check:
    enable: true
    url: https://cp.cloudflare.com/generate_204
    interval: 600
    timeout: 5 # ç§’
    lazy: true
    expected-status: "204"
    method: HEAD
  smux: # smuxï¼ˆè¿æ¥å¤ç”¨ï¼Œæå‡å¤šè·¯å¤ç”¨æ•ˆç‡ï¼Œå‡å°‘æ¡æ‰‹ï¼‰
    enabled: true # å¼€å¯ smux å¤šè·¯å¤ç”¨
    padding: true # å¢åŠ éšæœºæ•°æ®ï¼Œé˜²æ¢æµ‹ï¼ˆæ¨èå¼€ï¼‰
    protocol: smux # æˆ– smux4

ipv6: true
mixed-port: 7890
allow-lan: true
unified-delay: true
tcp-concurrent: true
find-process-mode: strict
global-client-fingerprint: chrome

keep-alive-idle: 600
keep-alive-interval: 15
disable-keep-alive: false

geodata-loader: standard
geo-auto-update: true
geox-url:
  mmdb: "https://geodata.kelee.one/Country-Masaiki.mmdb"
  asn: "https://geodata.kelee.one/GeoLite2-ASN-P3TERX.mmdb"

profile:
  store-selected: true
  store-fake-ip: true

external-controller: :9090

dns:
  enable: true
  listen: :1053
  ipv6: true

  prefer-h3: true          # ä¼˜å…ˆä½¿ç”¨ DoH3
  respect-rules: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16   # å®˜æ–¹ä¿ç•™æ®µï¼Œæ›´å®‰å…¨
  cache-size: 2048
  cache-algorithm: arc

  use-hosts: false
  use-system-hosts: false

  fake-ip-filter:
    - '*.lan'
    - '*.local'
    - 'stun.*'
    - 'localhost'
    - 'time.windows.com'
    - '*.ntp.org'
    - '*.stunprotocol.org'
    - '*.msftconnecttest.com'
    - '*.msftncsi.com'
    - '*.pool.ntp.org'
    - '*.qq.com'            # é¿å… QQ fake-ip å¯¼è‡´æ–‡ä»¶ä¼ è¾“å¤±è´¥
    - '*.weixin.qq.com'     # é¿å…å¾®ä¿¡å±€åŸŸç½‘äº’ä¼ å¤±è´¥
    - '*.battlenet.com.cn'  # æš´é›ªå±€åŸŸç½‘æ¸¸æˆéœ€è¦ç›´è¿è§£æ

  default-nameserver:
    - 1.1.1.1
    - 8.8.8.8
    - 2606:4700:4700::1111
    - 2001:4860:4860::8888

  nameserver:
    - https://1.1.1.1/dns-query
    - https://1.0.0.1/dns-query
    - https://dns.google/dns-query
    - https://doh.opendns.com/dns-query
    - 1.1.1.1
    - 8.8.8.8

  nameserver-policy:
    "rule-set:Direct,China":
      - https://223.5.5.5/dns-query
      - https://doh.pub/dns-query
      - https://120.53.53.53/dns-query
      - 223.5.5.5
      - 119.29.29.29
    "rule-set:Global,Final":
      - https://1.1.1.1/dns-query
      - https://1.0.0.1/dns-query
      - https://dns.google/dns-query
      - 1.1.1.1
      - 8.8.8.8

  fallback:
    - 8.8.4.4
    - 2001:4860:4860::8844

  proxy-server-nameserver:
    - https://1.1.1.1/dns-query
    - https://dns.google/dns-query
    - 1.1.1.1
    - 8.8.8.8

tun:
  enable: true
  stack: mixed
  auto-route: true
  auto-redirect: true
  strict-route: true
  auto-detect-interface: true

  dns-hijack:
    - any:53
    - tcp://any:53

  mtu: 1480     # æ›´ç¨³æ›´é€šç”¨
  gso: true
  gso-max-size: 65536
  udp-timeout: 300

sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [ "80", 8080-8880 ]
      override-destination: true   # è‡ªåŠ¨ä¿®æ­£é”™è¯¯åŸŸåï¼Œå¼ºçƒˆæ¨è
    TLS:
      ports: [ 443, 8443 ]
      override-destination: true
    QUIC:
      ports: [ 443, 8443 ]
      override-destination: true

  # å¼ºåˆ¶å—…æ¢
  force-domain:
    - "+.v2ex.com"                  # ä½ è‡ªå®šä¹‰çš„ä¿ç•™
    - "+.youtube.com"
    - "+.googlevideo.com"
    - "+.spotify.com"
    - "+.telegram.org"
    - "+.twitch.tv"

  # ç¦æ­¢å—…æ¢ï¼Œä»¥å…æ¨é€/å±€åŸŸç½‘å¼‚å¸¸
  skip-domain:
    - "Mijia Cloud"
    - "+.push.apple.com"           # é¿å… APNs æ–­æ¨é€
    - "+.icloud.com"               # é¿å… iCloud æŠ¥é”™
    - "+.local"
    - "+.lan"
    - "localhost"

tun-excluded-routes:
  - 224.0.0.0/3                  # å±€åŸŸç½‘å¹¿æ’­æµé‡
  - 239.255.255.250/32          # UPnP
  - 255.255.255.255/32          # å¹¿æ’­

proxy-providers:
  provider:
    <<: *dy
    lazy: true
    url: "https://sub.store/download/Firefly"

proxy-groups:
  - name: PROXY
    type: select
    include-all: true
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Proxy.png"

  - name: Static
    type: select
    proxies: [ Auto, HK, TW, JP, KR, US, SG, DIRECT, PROXY ]
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Static.png"

  - name: AI
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/AI.png"

  - name: Games
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Game.png"

  - name: PayPal
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/PayPal.png"

  - name: Telegram
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png"

  - name: Twitter
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/X.png"

  - name: Discord
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Discord.png"

  - name: Facebook
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Facebook.png"

  - name: Bahamut
    type: select
    proxies: [ DIRECT, TW, HK ]
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Bahamut.png"

  - name: Spotify
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Spotify.png"

  - name: TikTok
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/TikTok.png"

  - name: Bilibili
    type: select
    proxies: [ DIRECT, TW, HK ]
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/bilibili.png"

  - name: Netflix
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Netflix.png"

  - name: YouTube
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/YouTube.png"


  - name: Google
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Google_Search.png"

  - name: Apple
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Apple.png"

  - name: Microsoft
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Microsoft.png"

  - name: Bypass
    type: select
    proxies: [ DIRECT, Static ]
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Bypass.png"

  - name: Final
    type: select
    proxies: [ Static, Bypass ]
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png"

  - name: Auto
    <<: *pt
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Auto.png"

  #åˆ†éš”,ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  - name: HK
    <<: *pt
    filter: "(?i)ğŸ‡­ğŸ‡°|æ¸¯|HK|Hong"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png"

  - name: TW
    <<: *pt
    filter: "(?i)ğŸ‡¹ğŸ‡¼|å°|TW|Tai"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png"

  - name: JP
    <<: *pt
    filter: "(?i)ğŸ‡¯ğŸ‡µ|æ—¥|ä¸œäº¬|å¤§é˜ª|JP|Japan"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png"

  - name: KR
    <<: *pt
    filter: "(?i)ğŸ‡°ğŸ‡·|éŸ©|éŸ“|æœ|é¦–å°”|KR|Korea"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Korea.png"

  - name: US
    <<: *pt
    filter: "(?i)ğŸ‡ºğŸ‡¸|ç¾|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|US|States|American"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png"

  - name: SG
    <<: *pt
    filter: "(?i)ğŸ‡¸ğŸ‡¬|æ–°|ç‹®|ç…|SG|Singapore"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png"

rules:
  - RULE-SET,Lan,DIRECT
  - RULE-SET,Direct,DIRECT
  - RULE-SET,AWAvenue,REJECT
  - RULE-SET,Advertising,REJECT
  - RULE-SET,GameDownload,Bypass
  - RULE-SET,Claude,AI
  - RULE-SET,OpenAI,AI
  - RULE-SET,Gemini,AI
  - RULE-SET,Copilot,AI
  - RULE-SET,Game,Games
  - RULE-SET,PayPal,PayPal
  - RULE-SET,Telegram,Telegram
  - RULE-SET,Twitter,Twitter
  - RULE-SET,Discord,Discord
  - RULE-SET,Facebook,Facebook
  - RULE-SET,Bahamut,Bahamut
  - RULE-SET,Spotify,Spotify
  - RULE-SET,TikTok,TikTok
  - RULE-SET,Bilibili,Bilibili
  - RULE-SET,Netflix,Netflix
  - RULE-SET,YouTube,YouTube
  - RULE-SET,Google,Google
  - RULE-SET,Apple,Apple
  - RULE-SET,Microsoft,Microsoft
  - RULE-SET,Global,PROXY
  - RULE-SET,China,Bypass
  - RULE-SET,ChinaIP,Bypass,no-resolve
  - MATCH,Final

rule-anchor:
  class: &class { type: http, interval: 86400, behavior: classical }

rule-providers:
  Lan:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan.yaml"
  Direct:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Direct/Direct.yaml"
  AWAvenue:
    <<: *class
    url: "https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main/Filters/AWAvenue-Ads-Rule-Clash-Classical.yaml"
  Advertising:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Advertising/Advertising_Classical.yaml"
  GameDownload:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Game/GameDownload/GameDownload.yaml"
  Claude:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Claude/Claude.yaml"
  OpenAI:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.yaml"
  Gemini:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Gemini/Gemini.yaml"
  Copilot:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Copilot/Copilot.yaml"
  Game:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Game/Game.yaml"
  PayPal:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/PayPal/PayPal.yaml"
  Telegram:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Telegram/Telegram.yaml"
  Twitter:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Twitter/Twitter.yaml"
  Discord:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Discord/Discord.yaml"
  Facebook:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Facebook/Facebook.yaml"
  Bahamut:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Bahamut/Bahamut.yaml"
  Spotify:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Spotify/Spotify.yaml"
  TikTok:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/TikTok/TikTok.yaml"
  Bilibili:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/BiliBili/BiliBili.yaml"
  Netflix:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Netflix/Netflix.yaml"
  YouTube:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml"
  Google:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google.yaml"
  Apple:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Apple/Apple_Classical.yaml"
  Microsoft:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Microsoft/Microsoft.yaml"
  Global:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Global/Global_Classical.yaml"
  China:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/China/China_Classical.yaml"
  ChinaIP:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ChinaIPs/ChinaIPs_Classical.yaml"
