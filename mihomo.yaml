ps: &ps { type: select, proxies: [ PROXY, HK, TW, JP, KR, US, SG, DIRECT ] }
pt: &pt
  type: url-test
  url: https://cp.cloudflare.com/generate_204
  include-all: true
  tolerance: 50
  interval: 900 #å®‰å“å¯ç”¨1800ï¼Œä¹Ÿå°±æ˜¯åŠå°æ—¶
  lazy: false
  health-check:
    enable: true
    interval: 900
    url: https://cp.cloudflare.com/generate_204
    method: HEAD
    timeout: 5
    expected-status: "204"
dy: &dy
  type: http
  udp: true
  interval: 86400
  proxy: DIRECT
  lazy: true
  health-check:
    enable: true
    url: https://cp.cloudflare.com/generate_204
    interval: 600
    timeout: 5 # ç§’
    lazy: true
    expected-status: "204"
    method: HEAD
  smux: # smuxï¼ˆè¿æ¥å¤ç”¨ï¼Œæå‡å¤šè·¯å¤ç”¨æ•ˆç‡ï¼Œå‡å°‘æ¡æ‰‹ï¼‰
    enabled: true # å¼€å¯ smux å¤šè·¯å¤ç”¨
    padding: true # å¢åŠ éšæœºæ•°æ®ï¼Œé˜²æ¢æµ‹ï¼ˆæ¨èå¼€ï¼‰
    protocol: smux # æˆ– smux4

ipv6: true
mixed-port: 7890
allow-lan: true
unified-delay: true
tcp-concurrent: true
find-process-mode: strict
global-client-fingerprint: chrome
keep-alive-idle: 600
keep-alive-interval: 15
disable-keep-alive: false

geodata-loader: standard
geo-auto-update: true
geox-url:
  mmdb: 'https://geodata.kelee.one/Country-Masaiki.mmdb'
  asn: 'https://geodata.kelee.one/GeoLite2-ASN-P3TERX.mmdb'
profile:
  store-selected: true
  store-fake-ip: true
external-controller: :9090

tun:
  enable: false
  stack: mixed # system/gvisor/mixed
  auto-route: true
  auto-redirect: true
  auto-detect-interface: true
  strict-route: true # é¿å…å†—ä½™è·¯ç”±æ±¡æŸ“ç³»ç»Ÿè¡¨
  dns-hijack:
    - any:53
    - tcp://any:53
  mtu: 1500 # å‡å°‘ MTU é—®é¢˜ï¼Œå¦‚ç½‘é¡µæ— æ³•æ‰“å¼€ã€æµ‹é€Ÿæ…¢
  gso: true # å¯ç”¨é€šç”¨åˆ†æ®µå¸è½½ï¼ˆæå‡æ€§èƒ½ï¼‰
  gso-max-size: 65536
  udp-timeout: 300 # UDP ä¼šè¯ä¿æŒæ—¶é—´

dns:
  enable: true
  ipv6: true
  listen: :1053        # ç›‘å¬åœ°å€å’Œç«¯å£
  prefer-h3: false     # å¦‚æœDNSæœåŠ¡å™¨æ”¯æŒDoH3ä¼šä¼˜å…ˆä½¿ç”¨h3ï¼Œæå‡æ€§èƒ½
  respect-rules: true  # è®© DNS è§£æéµå¾ª Clash çš„è·¯ç”±è§„åˆ™
  cache-algorithm: arc # ä½¿ç”¨æ€§èƒ½æ›´ä¼˜çš„ ARC ç¼“å­˜ç®—æ³•
  cache-size: 2048     # é™åˆ¶ç¼“å­˜å¤§å°ï¼Œé¿å…å ç”¨è¿‡å¤šå†…å­˜

  use-hosts: false        # ä½¿ç”¨hosts
  use-system-hosts: false # ä½¿ç”¨ç³»ç»Ÿhosts

  enhanced-mode: fake-ip       # è®¾ç½®å¢å¼ºæ¨¡å¼ä¸º fake-ip æ¨¡å¼ï¼Œæé«˜è§£æé€Ÿåº¦å’Œè¿æ¥æ€§èƒ½
  fake-ip-range: 28.0.0.1/8
  fake-ip-filter:
    - +.lan

  default-nameserver:
    - 1.1.1.1                    # Cloudflare Public DNS (UDP)
    - 8.8.8.8                    # Google Public DNS (UDP)
  # - system                     # ç³»ç»Ÿ DNS (ä¿ç•™ä»¥é˜²ä¸‡ä¸€)

  nameserver: # é»˜è®¤ DNSï¼Œä¾›æ‰€æœ‰è¯·æ±‚ä½¿ç”¨ï¼Œæ”¯æŒ DoH3 çš„åœ¨å‰é¢
    - https://1.1.1.1/dns-query    # Cloudflareï¼ˆæ”¯æŒ H3ï¼‰
    - https://dns.google/dns-query # Googleï¼ˆæ”¯æŒ H3ï¼‰
    - 1.1.1.1                      # Cloudflare Public DNS (UDP)
    - 8.8.8.8                      # Google Public DNS (UDP)

  nameserver-policy:
    "rule-set:Direct,China": # ä¹Ÿå¯ä»¥ç”¨ geo:cn åŒ¹é… IP
      - https://223.5.5.5/dns-query
      - https://doh.pub/dns-query
      - 223.5.5.5                   # é˜¿é‡Œ UDP
      - 119.29.29.29                # è…¾è®¯ UDP
    "rule-set:Global": # æ–°å¢ï¼šéä¸­å›½å¤§é™†åŸŸåå¼ºåˆ¶èµ°å›½å¤– DNS
      - https://1.1.1.1/dns-query
      - https://dns.google/dns-query
      - 1.1.1.1
      - 8.8.8.8
    "full-nameserver": # æ–°å¢ï¼šæœ€ç»ˆå…œåº•ï¼Œæ‰€æœ‰æœªåŒ¹é…çš„åŸŸåæŸ¥è¯¢å¼ºåˆ¶èµ°å›½å¤– DNS
      - https://1.1.1.1/dns-query
      - https://dns.google/dns-query
      - 1.1.1.1
      - 8.8.8.8

  fallback:
    - 1.1.1.1 # Cloudflare DNSå¤‡ç”¨
    - 8.8.8.8 # Google DNSå¤‡ç”¨
    - 9.9.9.9 # Quad9 (å¤‡é€‰ï¼Œæ›´æ³¨é‡éšç§å’Œå®‰å…¨æ€§)

  proxy-server-nameserver: # å½“è¯·æ±‚é€šè¿‡ä»£ç†ï¼ˆå³å›½å¤–ç«™ï¼‰æ—¶ä½¿ç”¨
    - https://1.1.1.1/dns-query     # Cloudflareï¼ŒDoH3
    - https://dns.google/dns-query  # Googleï¼ŒDoH3
    - 1.1.1.1
    - 8.8.8.8

sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [ "80", 8080-8880 ]
      override-destination: true
    TLS:
      ports: [ 443, 8443 ]
    QUIC:
      ports: [ 443, 8443 ]
  force-domain:
    - "+.v2ex.com"
  skip-domain:
    - Mijia Cloud
    - '+.push.apple.com'

proxy-providers:
  provider:
    <<: *dy
    lazy: true
    url: "https://sub.store/download/Firefly"

proxy-groups:
  - name: PROXY
    type: select
    include-all: true
    proxies: [ Auto, HK, TW, JP, KR, US, SG, DIRECT ]
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Available.png"

  - name: Scholar
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/AI.png"

  - name: Telegram
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Telegram.png"

  - name: Twitter
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/X.png"

  - name: Discord
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Discord.png"

  - name: Facebook
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Facebook.png"

  - name: PayPal
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/PayPal.png"

  - name: Spotify
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Spotify.png"

  - name: TikTok
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/TikTok.png"

  - name: Bilibili
    type: select
    proxies: [ Bypass, TW, HK ]
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/bilibili.png"

  - name: Bahamut
    type: select
    proxies: [ TW, HK ]
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Bahamut.png"

  - name: YouTube
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/YouTube.png"

  - name: Netflix
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Netflix.png"

  - name: Google
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Google_Search.png"

  - name: Apple
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Apple.png"

  - name: Microsoft
    <<: *ps
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Microsoft.png"

  - name: Bypass
    type: select
    proxies: [ DIRECT, PROXY ]
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Bypass.png"

  - name: Final
    type: select
    proxies: [ PROXY, DIRECT ]
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Final.png"

  - name: Auto
    <<: *pt
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Auto.png"

  #åˆ†éš”,ä¸‹é¢æ˜¯åœ°åŒºåˆ†ç»„
  - name: HK
    <<: *pt
    filter: "(?i)ğŸ‡­ğŸ‡°|æ¸¯|HK|Hong"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Hong_Kong.png"

  - name: TW
    <<: *pt
    filter: "(?i)ğŸ‡¹ğŸ‡¼|å°|TW|Tai"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Taiwan.png"

  - name: JP
    <<: *pt
    filter: "(?i)ğŸ‡¯ğŸ‡µ|æ—¥|ä¸œäº¬|å¤§é˜ª|JP|Japan"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Japan.png"

  - name: KR
    <<: *pt
    filter: "(?i)ğŸ‡°ğŸ‡·|éŸ©|éŸ“|æœ|é¦–å°”|KR|Korea"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Korea.png"

  - name: US
    <<: *pt
    filter: "(?i)ğŸ‡ºğŸ‡¸|ç¾|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’å†ˆ|å‡¤å‡°åŸ|è´¹åˆ©è’™|ç¡…è°·|æ‹‰æ–¯ç»´åŠ æ–¯|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|US|States|American"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/United_States.png"

  - name: SG
    <<: *pt
    filter: "(?i)ğŸ‡¸ğŸ‡¬|æ–°|ç‹®|ç…|SG|Singapore"
    icon: "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Singapore.png"

rules:
  - RULE-SET,Lan,DIRECT
  - RULE-SET,Direct,DIRECT
  - RULE-SET,AWAvenue,REJECT
  - RULE-SET,Advertising,REJECT
  - RULE-SET,OpenAI,Scholar
  - RULE-SET,Gemini,Scholar
  - RULE-SET,Copilot,Scholar
  - RULE-SET,Telegram,Telegram
  - RULE-SET,Twitter,Twitter
  - RULE-SET,Discord,Discord
  - RULE-SET,Facebook,Facebook
  - RULE-SET,PayPal,PayPal
  - RULE-SET,Spotify,Spotify
  - RULE-SET,TikTok,TikTok
  - RULE-SET,Bilibili,Bilibili
  - RULE-SET,Bahamut,Bahamut
  - RULE-SET,YouTube,YouTube
  - RULE-SET,Netflix,Netflix
  - RULE-SET,Google,Google
  - RULE-SET,Apple,Apple
  - RULE-SET,Microsoft,Microsoft
  - RULE-SET,Global,PROXY
  - RULE-SET,China,Bypass
  - RULE-SET,ChinaIP,Bypass,no-resolve
  - MATCH,Final

rule-anchor:
  class: &class { type: http, interval: 86400, behavior: classical }

rule-providers:
  Lan:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan.yaml"
  Direct:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Direct/Direct.yaml"
  AWAvenue:
    <<: *class
    url: "https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main/Filters/AWAvenue-Ads-Rule-Clash-Classical.yaml"
  Advertising:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Advertising/Advertising_Classical.yaml"
  OpenAI:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.yaml"
  Gemini:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Gemini/Gemini.yaml"
  Copilot:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Copilot/Copilot.yaml"
  Telegram:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Telegram/Telegram.yaml"
  Twitter:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Twitter/Twitter.yaml"
  Discord:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Discord/Discord.yaml"
  Facebook:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Facebook/Facebook.yaml"
  PayPal:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/PayPal/PayPal.yaml"
  Spotify:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Spotify/Spotify.yaml"
  TikTok:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/TikTok/TikTok.yaml"
  Bilibili:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/BiliBili/BiliBili.yaml"
  Bahamut:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Bahamut/Bahamut.yaml"
  YouTube:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml"
  Netflix:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Netflix/Netflix.yaml"
  Google:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Google/Google.yaml"
  Apple:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Apple/Apple_Classical.yaml"
  Microsoft:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Microsoft/Microsoft.yaml"
  Global:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Global/Global_Classical.yaml"
  China:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/China/China_Classical.yaml"
  ChinaIP:
    <<: *class
    url: "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ChinaIPs/ChinaIPs_Classical.yaml"
