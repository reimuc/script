#!name = YouTube
#!desc = ðŸ“· DualSubs YouTube Enhance
#!icon = https://raw.githubusercontent.com/Orz-3/mini/master/Color/YouTube.png
#!homepage = https://dualsubs.github.io
#!openUrl = http://boxjs.com/#/app/DualSubs.YouTube

[Rule]
AND,((DOMAIN-SUFFIX,googlevideo.com),(PROTOCOL,UDP)),REJECT
AND,((DOMAIN,youtubei.googleapis.com),(PROTOCOL,UDP)),REJECT

[Rewrite]
^https?:\/\/[\w-]+\.googlevideo\.com\/initplayback(\?.*oad=.+)$ reject-img

[Script]
# Maasea YouTube Response
http-response ^https:\/\/youtubei\.googleapis\.com\/youtubei\/v1\/(browse|next|player|search|reel\/reel_watch_sequence|guide|account\/get_setting|get_watch)(\?.*)?$ requires-body=1, binary-body-mode=1, script-path=https://raw.githubusercontent.com/Maasea/sgmodule/master/Script/Youtube/youtube.response.js

# DualSubs YouTube Request
http-request ^https?:\/\/((www|m|tv)\.youtube\.com\/youtubei\/v1\/player|music\.youtube\.com\/youtubei\/v1\/browse)(\?.+)?$ requires-body=1, script-path=https://github.com/DualSubs/YouTube/releases/latest/download/request.bundle.js
http-request ^https?:\/\/youtubei\.googleapis\.com\/youtubei\/v1\/(player|browse)(\?.+)?$ requires-body=1, binary-body-mode=1, script-path=https://github.com/DualSubs/YouTube/releases/latest/download/request.bundle.js
http-request ^https?:\/\/(www|m)\.youtube\.com\/api\/timedtext(\?.+)?$ script-path=https://github.com/DualSubs/YouTube/releases/latest/download/request.bundle.js

# DualSubs YouTube Response
http-response ^https?:\/\/(www|m|tv)\.youtube\.com\/youtubei\/v1\/player(\?.+)?$ requires-body=1, script-path=https://github.com/DualSubs/YouTube/releases/latest/download/response.bundle.js
http-response ^https?:\/\/youtubei\.googleapis\.com\/youtubei\/v1\/(player|get_watch)(\?.+)?$ requires-body=1, binary-body-mode=1, script-path=https://github.com/DualSubs/YouTube/releases/latest/download/response.bundle.js

# Timedtext Response
http-response ^https?:\/\/(www|m)\.youtube\.com\/api\/timedtext\?(.*)subtype=(Official|External) requires-body=1, script-path=https://github.com/DualSubs/Universal/releases/latest/download/Composite.Subtitles.response.bundle.js
http-response ^https?:\/\/(www|m)\.youtube\.com\/api\/timedtext\?(.*)subtype=Translate requires-body=1, script-path=https://github.com/DualSubs/Universal/releases/latest/download/Translate.response.bundle.js
http-response ^https?:\/\/(music\.youtube\.com|youtubei\.googleapis\.com)\/youtubei\/v1\/browse\?(.*)subtype=Translate requires-body=1, binary-body-mode=1, script-path=https://github.com/DualSubs/Universal/releases/latest/download/Translate.response.bundle.js

[Mitm]
hostname = *.youtube.com, youtubei.googleapis.com, *.googlevideo.com
